# Changelog

## [1.1.9] - 2025-12-24
### 修复
- **重大修复：解决 MariaDB 启动检测死循环**：
    - 废弃了不稳定的静态二进制 Docker 安装，全面切换为官方 `get.docker.com` 安装模式。此举确保了 Docker 守护进程与 Ubuntu 24.04 等现代系统的 Cgroup v2 驱动及网络栈完美匹配。
    - 进一步下调 `DOCKER_API_VERSION` 至 `1.35`，从而强制兼容旧版 Trojan 管理器的数据库检测协议。
    - 依赖补全：系统级增加了 `mariadb-client` 安装，为后续检测提供底层支持。

## [1.1.8] - 2025-12-24
### 修复
- **解决 MariaDB 启动检测死循环**：在执行管理程序前注入了 `DOCKER_API_VERSION=1.41` 环境变量，解决了在 Ubuntu 24.04 等新系统上管理程序因 Docker API 版本差异无法正确获取容器健康状态的问题。
- **增强安装反馈**：在移交控制权给管理程序前，增加了对 MariaDB 容器及其映射端口的实时检测，并向用户提供明确的状态提示。

## [1.1.7] - 2025-12-24
### 优化
- **Docker 安装策略重构**：将安装逻辑切换为“系统包管理器优先 (System Package First)”。脚本现在会优先尝试通过 `apt-get` 或 `yum` 安装系统原生的 Docker 及其配套组件。
- **兼容性提升**：由于系统包管理器能自动处理 `iptables`、`cgroup` 等内核依赖，此变动彻底解决了在 Ubuntu 24.04 (Noble) 及其他现代 Linux 发行版上静态二进制 Docker 无法启动导致的 MariaDB 安装死循环问题。
- **保留兜底逻辑**：依然保留了静态二进制安装作为极端环境下的最后兜底手段。

## [1.1.6] - 2025-12-24
### 修复
- **补全 Docker 依赖**：增加了 `iptables` 和 `iproute2` 基础组件的安装，解决了在纯净版 Ubuntu 24.04 (Noble) 下 Docker 守护进程因缺少网络过滤组件而启动失败的问题。
- **增强故障诊断**：在 Docker 启动失败并触发 `FATAL` 报错时，脚本会自动联调并打印 `/var/log/dockerd.log` 的最后 20 行，帮助用户快速锁定底层系统错误。

## [1.1.5] - 2025-12-24
### 修复
- **深度加固**：在 Docker 守护进程无法启动时增加“硬失败”校验。如果多次尝试后 Docker 依然不可用，脚本将强制报错退出（`exit 1`），严禁进入 Trojan 管理器的 MariaDB 安装环节。
- **兼容性增强**：增加了对 `snap` 管理的 Docker 服务的启动支持，并支持对 `docker.socket` 的自动取消挂载（unmask）。

## [1.1.4] - 2025-12-24
### 修复
- 修复 Docker 已安装但守护进程未运行导致 MariaDB 安装死循环的问题。在脚本中增加了对 Docker 状态的检测（`docker info`）及自动启动逻辑，确保环境就绪。

## [1.1.3] - 2025-12-24
### 修复
- 进一步修复 `acme.sh` 安装失败问题。摒弃了脆弱的单文件手动安装模式，改用官方推荐的 `--install-online` 流式安装，从根本上消除了 `cp` 命令寻找路径失败的隐患。

## [1.1.2] - 2025-12-24
### 修复
- 修复 `install.sh` 中 `acme.sh` 安装失败的问题。通过在调用安装脚本前切换到 `/tmp` 目录，解决了 `cp` 命令由于找不到源文件导致的安装中断。

### 修改人
- Antigravity (AI Assistant)
